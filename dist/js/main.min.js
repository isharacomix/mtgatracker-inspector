/*!
 * Start Bootstrap - SB Admin 2 v3.3.7+1 (http://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2018 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
$(function(){$("#side-menu").metisMenu()});var appData={username:"unknown",homeDeckList:[],homeGameList:[],homeGameListPage:1};rivets.binders.linegame=function(e,o){console.log(o.won),$(e).removeClass("danger").removeClass("success"),console.log($(e)),o.won?($(e).addClass("success"),e.innerHTML='<i class="fa fa-check-circle"></i>'):($(e).addClass("danger"),e.innerHTML='<i class="fa fa-exclamation-circle"></i>')},$(function(){var e=getCookie("username");$("#username").val(e),appData.username=e,rivets.bind($("#app"),{data:appData}),$(window).bind("load resize",function(){var e=50,o=this.window.innerWidth>0?this.window.innerWidth:this.screen.width;o<768?($("div.navbar-collapse").addClass("collapse"),e=100):$("div.navbar-collapse").removeClass("collapse");var n=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1;n-=e,n<1&&(n=1),n>e&&$("#page-wrapper").css("min-height",n+"px")});for(var o=window.location,n=$("ul.nav a").filter(function(){return this.href==o}).addClass("active").parent();;){if(!n.is("li"))break;n=n.parent().addClass("in").parent()}});var getCookie=function(e){for(var o=e+"=",n=decodeURIComponent(document.cookie),a=n.split(";"),s=0;s<a.length;s++){for(var t=a[s];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return""},logout=function(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",document.location.href="login.html"},authAttempt=function(){$("#auth-loading").css("opacity","1"),$("#token-submit-button").addClass("btn-primary").removeClass("btn-success").val("Attempting to log in...").prop("disabled",!0),username=$("#username").val(),accessCode=$("#access-code").val(),$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/public-api/auth-attempt",type:"POST",data:JSON.stringify({username:username,accessCode:accessCode}),dataType:"json",contentType:"application/json",success:function(e){document.cookie="token="+e.token,document.location.href=".."},error:function(e,o,n){$("#token-submit-button").removeClass("btn-primary").addClass("btn-success").val("Log in").prop("disabled",!1),$("#auth-loading").css("opacity","0"),$("#access-code").pincodeInput().data("plugin_pincodeInput").clear(),console.log("error! "+o),console.log(e),console.log(o),console.log(n),e.responseJSON.error.includes("auth_error")?toastr.error("Incorrect code, try again"):toastr.error("An unknown error occurred, please try again")}})},authRequest=function(){$("#token-loading").css("opacity","1"),$("#token-req-button").addClass("btn-primary").removeClass("btn-success").val("Sending token...").prop("disabled",!0),username=$("#username").val(),console.log(username),$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/public-api/auth-request",type:"POST",data:JSON.stringify({username:username}),dataType:"json",contentType:"application/json",success:function(e){$("#username").val(e.username),document.cookie="username = "+e.username,$("#auth-container").slideDown(),$("#access-code").pincodeInput({hideDigits:!1,keydown:function(e){console.log(e)},inputs:6,complete:function(e,o,n){authAttempt()}}),$("#token-req-button").addClass("btn-primary").removeClass("btn-success").val("Token Sent").prop("disabled",!0),$("#token-loading").css("opacity","0"),console.log(e.request)},error:function(e,o,n){$("#token-loading").css("opacity","0"),console.log("error! "+o),console.log(e),console.log(o),console.log(n),e.responseJSON.error.includes("no user found")?($("#token-req-button").removeClass("btn-primary").addClass("btn-success").val("Request Token").prop("disabled",!1),toastr.error("User not found.<br>Note that you must have used MTGATracker to track at least one game in order to log in!")):e.responseJSON.error.includes("discord mapping not found")?($("#token-req-button").addClass("btn-primary").removeClass("btn-success").val("Redirecting...").prop("disabled",!0),window.stop(),window.location.href="https://github.com/shawkinsl/mtga-tracker/blob/master/logging_in.md"):($("#token-req-button").removeClass("btn-primary").addClass("btn-success").val("Request Token").prop("disabled",!1),toastr.error("An unknown error occurred, please try again"))}})},getDecks=function(){$("#decks-loading").css("display","block"),token=getCookie("token"),token&&$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/api/decks",headers:{token:token},success:function(e){$("#decks-loading").css("display","none"),appData.homeDeckList=[],$.each(e,function(e,o){appData.homeDeckList.push(o)})},error:function(e){e.responseJSON.error&&"your account has been locked"==e.responseJSON.error&&appData.homeDeckList.push({deckName:"Your account has been locked!",wins:"?",losses:"?",link:"https://github.com/shawkinsl/mtga-tracker/blob/master/logging_in.md#inspector-says-my-account-is-locked-what-gives"}),$("#decks-loading").css("display","none")}})},getGames=function(e){console.log("getting games..."),$("#more-games-button").removeClass("btn-info").addClass("btn-primary").val("Loading games...").prop("disabled",!0),appData.homeGameListPage+=1,void 0===e&&(e=1),token=getCookie("token"),token&&$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/api/games?page="+e,headers:{token:token},success:function(e){$("#more-games-button").removeClass("btn-primary").addClass("btn-info").val("Load more games").prop("disabled",!1),$("#timeline-loading").css("display","none"),$.each(e.docs,function(e,o){newVal={},newVal.hero=o.hero,newVal.opponent=o.opponent,newVal.heroDeckName=o.players[0].deck.poolName,newVal.opponentDeckName=o.players[1].deck.poolName,newVal.timeago=timeago().format(o.date),newVal.won=o.winner==o.hero,newVal.winner=o.winner,appData.homeGameList.push(newVal)})},error:function(e){e.responseJSON.error&&"your account has been locked"==e.responseJSON.error&&appData.homeGameList.push({heroDeckName:"Your account has been locked!",timeago:"Click here for more info",hero:"unknown",opponent:"unknown",winner:"unknown",link:"https://github.com/shawkinsl/mtga-tracker/blob/master/logging_in.md#inspector-says-my-account-is-locked-what-gives"}),$("#timeline-loading").css("display","none")}})};