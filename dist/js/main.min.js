/*!
 * Start Bootstrap - SB Admin 2 v3.3.7+1 (http://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2018 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
$(function(){$("#side-menu").metisMenu()});var appData={username:"unknown"};$(function(){var e=getCookie("username");$("#username").val(e),appData.username=e,rivets.bind($("#app"),{data:appData}),$(window).bind("load resize",function(){var e=50,o=this.window.innerWidth>0?this.window.innerWidth:this.screen.width;o<768?($("div.navbar-collapse").addClass("collapse"),e=100):$("div.navbar-collapse").removeClass("collapse");var n=(this.window.innerHeight>0?this.window.innerHeight:this.screen.height)-1;n-=e,n<1&&(n=1),n>e&&$("#page-wrapper").css("min-height",n+"px")});for(var o=window.location,n=$("ul.nav a").filter(function(){return this.href==o}).addClass("active").parent();;){if(!n.is("li"))break;n=n.parent().addClass("in").parent()}$("#access-code").pincodeInput({hideDigits:!1,inputs:6,complete:function(e,o,n){authAttempt()}})});var getCookie=function(e){for(var o=e+"=",n=decodeURIComponent(document.cookie),t=n.split(";"),a=0;a<t.length;a++){for(var s=t[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(o))return s.substring(o.length,s.length)}return""},logout=function(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",document.location.href="login.html"},authAttempt=function(){$("#auth-loading").css("opacity","1"),$("#token-submit-button").addClass("btn-primary").removeClass("btn-success").val("Attempting to log in...").prop("disabled",!0),username=$("#username").val(),accessCode=$("#access-code").val(),$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/public-api/auth-attempt",type:"POST",data:JSON.stringify({username:username,accessCode:accessCode}),dataType:"json",contentType:"application/json",success:function(e){document.cookie="token="+e.token,document.location.href=".."},error:function(e,o,n){$("#token-submit-button").removeClass("btn-primary").addClass("btn-success").val("Log in").prop("disabled",!1),$("#auth-loading").css("opacity","0"),$("#access-code").pincodeInput().data("plugin_pincodeInput").clear(),console.log("error! "+o),console.log(e),console.log(o),console.log(n),e.responseJSON.error.includes("auth_error")?toastr.error("Incorrect code, try again"):toastr.error("An unknown error occurred, please try again")}})},authRequest=function(){$("#token-loading").css("opacity","1"),$("#token-req-button").addClass("btn-primary").removeClass("btn-success").val("Sending token...").prop("disabled",!0),username=$("#username").val(),document.cookie="username = "+username,console.log(username),$.ajax({url:"https://wt.mtgatracker.com/wt-bd90f3fae00b1572ed028d0340861e6a-0/mtgatracker-prod-EhDvLyq7PNb/public-api/auth-request",type:"POST",data:JSON.stringify({username:username}),dataType:"json",contentType:"application/json",success:function(e){$("#auth-container").slideDown(),$("#token-req-button").addClass("btn-primary").removeClass("btn-success").val("Token Sent").prop("disabled",!0),$("#token-loading").css("opacity","0"),console.log(e.request)},error:function(e,o,n){$("#token-req-button").removeClass("btn-primary").addClass("btn-success").val("Request Token").prop("disabled",!1),$("#token-loading").css("opacity","0"),console.log("error! "+o),console.log(e),console.log(o),console.log(n),e.responseJSON.error.includes("no user found")?toastr.error("User not found.<br>Note that you must have used MTGATracker to track at least one game in order to log in!"):e.responseJSON.error.includes("discord mapping not found")?window.location.href="https://github.com/shawkinsl/mtga-tracker/blob/user/shawkins/inspector/logging_in.md":toastr.error("An unknown error occurred, please try again")}})};